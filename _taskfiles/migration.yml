version: '3'

vars:
  GO_COMMAND: go
  MIGRATE_COMMAND: github.com/golang-migrate/migrate/v4/cmd/migrate

tasks:
  create:
    desc: "Create migration file. Usage: task mig:create name=<name>"
    dir: ./migration
    requires:
      vars: [ name ]
    vars:
      name: "{{.name}}"
    cmds:
      - |
        {{.GO_COMMAND}} run {{.MIGRATE_COMMAND}} create -ext sql -dir . -seq {{.name}}

  run:
    dotenv: [.env.local]
    desc: "Run migrations according to _currentMigrationVersion"
    cmds:
      - |
        {{.GO_COMMAND}} run ./_dev/migration/run.go